# c11parser_cxx

## Overview

This repo contains a version written in C++ of the C11 parser described in the paper, A simple, possibly correct LR parser for C11, Jourdan and Pottier, ACM Transactions on Programming Languages and Systems (TOPLAS), 39(4), August 2017.

The parser in this repo is based on code from the companion repo for the paper at https://github.com/jhjourdan/C11parser. In particular, the Bison rules file, [`c11parser.bison.y`](src/grammar/c11parser.bison.y), is modified from https://github.com/jhjourdan/C11parser/blob/master/parser.y.

The paper describes various ambiguities in the C11 standard that make it challenging to write a conformant parser. The paper contains a context-free grammar for an LALR(1) parser that tackles thorny problems like ambiguous identifiers, dangling else, ambiguous struct and parameter declarations, and ambiguous use of `_Atomic`. The parser resolves ambiguities in type versus variable declarations with the help of lexical feedback on a clever split token built into the grammar.

I would highly recommend the paper and its repo for anyone interested in the grammar and rules for C. And it can serve as a very practical starting point for writing a C parser or compiler.

The parser from the paper is written in OCaml and uses Menhir and OCamllex parser generator tools.

The parser in our repo is written in C++ and uses Bison and Flex parser generator tools. The design closely follows the OCaml parser and allows a C++ programmer with no knowledge of OCaml to examine and try out a working implementation of techniques from the paper.

## Build And Test

Build with `cmake` then `make`

```
cmake -B build -S .

make -C build
```

Run unit tests with `ctest`
```
ctest --test-dir build
```

## Source Structure

```
src
├── CMakeLists.txt
├── declarator
│   ├── context.h
│   └── declarator.h
├── grammar
│   ├── CMakeLists.txt
│   ├── c11parser.bison.y
│   └── c11parser.flex.l
├── lexer
│   ├── CMakeLists.txt
│   ├── c11parser_guard_flexlexer.h
│   ├── c11parser_lexer.gtest.cpp
│   └── c11parser_lexer.h
├── parser
│   ├── CMakeLists.txt
│   └── c11parser.gtest.cpp
```

Source code in [`src/`](src/) has four main directories.

- [`grammar/`](src/grammar) contains Bison and Flex rules files. The parser and lexer code generated by these tools are in the corresponding cmake build directory.
- [`lexer/`](src/lexer) has the custom lexer class derived from the Flex `yyFlexLexer` base class. It also has some basic unit tests for the lexer.
- [`parser/`](src/parser) has all test cases from the paper's repo converted to unit tests for GoogleTest.
- [`declarator/`](src/declarator) has couple simple classes that support the lexical feedback mechanism described in the paper.
